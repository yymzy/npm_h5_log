"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Robot=require("dingtalk-robot-sender");function _interopDefaultLegacy(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var Robot__default=_interopDefaultLegacy(Robot),__assign=function(){return(__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function __spreadArrays(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var CollectError=function(){function t(){this.maps=[],this.title=""}return t.prototype.collect=function(t,e){this.maps.push(t),this.title||(this.title=e)},t.prototype.get=function(){return __spreadArrays([this.title],this.maps)},t.prototype.clear=function(){this.title="",this.maps=[]},t}(),defaults={ua:window.navigator.userAgent,browser:getBrowser(),os:getDevices(),osVersion:getSystemVersion(),errUrl:window.location.href,msg:"",url:"",line:"",col:"",error:""};function getSystemVersion(){var t=window.navigator.userAgent;return 0<=t.indexOf("CPU iPhone OS ")?t.substring(t.indexOf("CPU iPhone OS ")+14,t.indexOf(" like Mac OS X")):0<=t.indexOf("Android ")?t.substr(t.indexOf("Android ")+8,3):""}function getBrowser(){var t=window.navigator.userAgent,e=-1<t.indexOf("Opera");return e?"Opera":-1<t.indexOf("Firefox")?"FF":-1<t.indexOf("Chrome")?"Chrome":-1<t.indexOf("Safari")?"Safari":-1<t.indexOf("compatible")&&-1<t.indexOf("MSIE")&&!e?"IE":void 0}function getDevices(){var t=window.navigator.userAgent;if((/AppleWebKit.*Mobile/i.test(window.navigator.userAgent)||/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(window.navigator.userAgent))&&window.location.href.indexOf("?mobile")<0)try{return/iPhone|mac|iPod|iPad/i.test(window.navigator.userAgent)?"iPhone":"Android"}catch(t){}return-1<t.indexOf("iPad")?"iPhone":"Android"}function Markdown(){this.text="",this.title="",this.items=[],this.setTitle=function(t){return this.title=t,this},this.add=function(t){return Array.isArray(t)?this.items.concat(t):this.items.push(t),this.text=this.items.join("\n"),this}}function ddNotice(o,a){return new Promise(function(t,e){var n=new Robot__default.default(__assign({baseUrl:"https://oapi.dingtalk.com/robot/send"},o.dd)),r=o.name||"Error",i=(new Markdown).setTitle(r).add("["+r+"]\n");a.forEach(function(t,e){0<e&&i.add("--------------ERROR"+(""+e).padStart(3,"0")+"--------------\n"),Array.isArray(t)?t.forEach(function(t){i.add(t+"\n")}):i.add(t+"\n")}),n.markdown(i.title,i.text).then(t).catch(e)})}function report(t,e){return e.dd?ddNotice(e,t).then(e.success).catch(e.fail):Promise.resolve()}var run=function(u,d){var l,c=new CollectError;window.onerror=function(t,i,o,a,s){return setTimeout(function(){if(a=a||window.event&&window.event.errorCharacter||0,defaults.url=i,defaults.line=""+o,defaults.col=""+a,s&&s.stack)defaults.msg=s.stack.toString();else if(arguments.callee){for(var t=[],e=arguments.callee.caller,n=3;e&&0<--n&&(t.push(e.toString()),e!==e.caller);)e=e.caller;defaults.msg=t.join(",")}var r=__assign(__assign({},null===(r=u.ajax)||void 0===r?void 0:r.data),defaults);"function"==typeof d&&d(r),c.collect(["position："+defaults.url+":"+defaults.line+":"+defaults.col,"message："+defaults.msg],defaults.ua),clearTimeout(l),l=setTimeout(function(){report(c.get(),u).then(function(){c.clear()})},1e3*(u.delay||1))},0),!0}};function h5Log(t,e){return run(t,e)}exports.h5Log=h5Log;
//# sourceMappingURL=index.js.map
